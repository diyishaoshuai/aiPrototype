<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>é¦–é¡µ - çŸ­è§†é¢‘</title>
  <link rel="stylesheet" href="../components/common.css">
  <link rel="stylesheet" href="../components/styles.css">
</head>
<body>
  <div class="video-container" id="videoContainer"></div>
  <div id="bottomNav"></div>

  <!-- è¯„è®ºå¼¹çª— -->
  <div id="commentModal" class="modal">
    <div class="modal-content comment-modal">
      <div class="modal-header">
        <span>8234æ¡è¯„è®º</span>
        <span class="close" onclick="closeComments()">Ã—</span>
      </div>
      <div class="comment-list" id="commentList"></div>
      <div class="comment-input">
        <input type="text" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." id="commentInput">
        <button onclick="submitComment()">å‘é€</button>
      </div>
    </div>
  </div>

  <!-- åˆ†äº«å¼¹çª— -->
  <div id="shareModal" class="modal">
    <div class="modal-content share-modal">
      <div class="modal-header">
        <span>åˆ†äº«åˆ°</span>
        <span class="close" onclick="closeShare()">Ã—</span>
      </div>
      <div class="share-options">
        <div class="share-item" onclick="shareToWechat()">
          <div class="share-icon">ğŸ’¬</div>
          <div class="share-text">å¾®ä¿¡</div>
        </div>
        <div class="share-item" onclick="shareToMoments()">
          <div class="share-icon">ğŸ”„</div>
          <div class="share-text">æœ‹å‹åœˆ</div>
        </div>
        <div class="share-item" onclick="copyLink()">
          <div class="share-icon">ğŸ”—</div>
          <div class="share-text">å¤åˆ¶é“¾æ¥</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toastæç¤º -->
  <div id="toast" class="toast"></div>

  <script src="../components/video-item.js"></script>
  <script src="../components/action-buttons.js"></script>
  <script src="../components/bottom-nav.js"></script>
  <script>
    const videos = [
      { id: 1, title: 'ç¾é£Ÿæ¢åº—', bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
      { id: 2, title: 'æ—…è¡Œæ—¥è®°', bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' },
      { id: 3, title: 'æç¬‘æ®µå­', bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)' },
      { id: 4, title: 'èˆè¹ˆæ•™å­¦', bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)' },
      { id: 5, title: 'æ¸¸æˆå®å†µ', bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)' }
    ];

    let currentIndex = 0;
    let startY = 0;
    let isDragging = false;
    const bottomNav = new BottomNav('home');

    function initPage() {
      const container = document.getElementById('videoContainer');
      videos.forEach((video, index) => {
        const item = document.createElement('div');
        item.className = 'video-item' + (index === 0 ? ' active' : (index === 1 ? ' next' : ''));
        item.style.background = video.bg;
        item.innerHTML = `
          <div class="video-placeholder">
            <div class="video-number">#${video.id}</div>
            <div class="video-title">${video.title}</div>
          </div>
          <div class="action-buttons">
            <div class="action-btn" onclick="toggleLike(this)">
              <div class="action-icon">â¤ï¸</div>
              <div class="action-text">12.5w</div>
            </div>
            <div class="action-btn" onclick="showComments()">
              <div class="action-icon">ğŸ’¬</div>
              <div class="action-text">8234</div>
            </div>
            <div class="action-btn" onclick="showShare()">
              <div class="action-icon">ğŸ“¤</div>
              <div class="action-text">åˆ†äº«</div>
            </div>
          </div>
        `;
        container.appendChild(item);
      });

      document.getElementById('bottomNav').innerHTML = bottomNav.render();
      setupSwipe();
    }

    // åˆ‡æ¢è§†é¢‘
    function switchVideo(direction) {
      const items = document.querySelectorAll('.video-item');
      const newIndex = currentIndex + direction;
      if (newIndex < 0 || newIndex >= videos.length) {
        resetPosition();
        return;
      }

      items.forEach(item => {
        item.classList.remove('active', 'prev', 'next');
        item.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        item.style.transform = '';
      });

      items[currentIndex].classList.add(direction > 0 ? 'prev' : 'next');
      items[newIndex].classList.add('active');
      if (newIndex + 1 < videos.length) items[newIndex + 1].classList.add('next');
      if (newIndex - 1 >= 0) items[newIndex - 1].classList.add('prev');
      currentIndex = newIndex;
    }

    // é‡ç½®ä½ç½®
    function resetPosition() {
      const items = document.querySelectorAll('.video-item');
      items.forEach(item => {
        item.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        item.style.transform = '';
      });
    }

    // è®¾ç½®æ»‘åŠ¨
    function setupSwipe() {
      const container = document.getElementById('videoContainer');
      let startY = 0;
      let currentY = 0;
      let isDragging = false;
      let startTime = 0;

      // è§¦æ‘¸äº‹ä»¶
      container.addEventListener('touchstart', handleStart);
      container.addEventListener('touchmove', handleMove, { passive: false });
      container.addEventListener('touchend', handleEnd);

      // é¼ æ ‡äº‹ä»¶
      container.addEventListener('mousedown', handleStart);
      container.addEventListener('mousemove', handleMove);
      container.addEventListener('mouseup', handleEnd);
      container.addEventListener('mouseleave', handleEnd);

      function handleStart(e) {
        startY = e.touches ? e.touches[0].clientY : e.clientY;
        currentY = startY;
        isDragging = true;
        startTime = Date.now();
        container.style.transition = 'none';
        container.style.cursor = 'grabbing';
      }

      function handleMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        currentY = e.touches ? e.touches[0].clientY : e.clientY;
        const diff = currentY - startY;
        const items = document.querySelectorAll('.video-item');

        items.forEach((item) => {
          if (item.classList.contains('active')) {
            item.style.transform = `translateY(${diff}px)`;
          } else if (item.classList.contains('next')) {
            item.style.transform = `translateY(calc(100% + ${diff}px))`;
          } else if (item.classList.contains('prev')) {
            item.style.transform = `translateY(calc(-100% + ${diff}px))`;
          }
        });
      }

      function handleEnd(e) {
        if (!isDragging) return;
        const diff = currentY - startY;
        const duration = Date.now() - startTime;
        const velocity = Math.abs(diff) / duration;

        container.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        container.style.cursor = 'grab';

        if (Math.abs(diff) > 80 || velocity > 0.5) {
          if (diff < 0) switchVideo(1);
          else if (diff > 0) switchVideo(-1);
          else resetPosition();
        } else {
          resetPosition();
        }

        isDragging = false;
      }
    }

    // ç‚¹èµ
    function toggleLike(btn) {
      btn.classList.toggle('liked');
      const text = btn.querySelector('.action-text');
      text.textContent = btn.classList.contains('liked') ? '12.6w' : '12.5w';
    }

    // è¯„è®ºåŠŸèƒ½
    const comments = [
      { id: 1, user: 'ç”¨æˆ·A', content: 'å¤ªå¥½çœ‹äº†ï¼', likes: 128, replies: [] },
      { id: 2, user: 'ç”¨æˆ·B', content: 'åœ¨å“ªé‡Œæ‹çš„ï¼Ÿ', likes: 56, replies: [
        { id: 3, user: 'ä½œè€…', content: 'åœ¨åŒ—äº¬', likes: 12 }
      ]}
    ];
    let replyingTo = null;

    // Toastæç¤º
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }

    function showComments() {
      document.getElementById('commentModal').style.display = 'flex';
      renderComments();
    }

    function closeComments() {
      document.getElementById('commentModal').style.display = 'none';
    }

    function renderComments() {
      const list = document.getElementById('commentList');
      list.innerHTML = comments.map(c => `
        <div class="comment-item">
          <div class="comment-header">
            <span class="comment-user">${c.user}</span>
            <span class="comment-like" onclick="likeComment(${c.id})">
              â¤ï¸ ${c.likes}
            </span>
          </div>
          <div class="comment-content">${c.content}</div>
          ${c.replies.length > 0 ? `
            <div class="comment-replies">
              ${c.replies.map(r => `
                <div class="reply-item">
                  <span class="reply-user">${r.user}:</span>
                  <span class="reply-content">${r.content}</span>
                </div>
              `).join('')}
            </div>
          ` : ''}
          <div class="comment-actions">
            <span onclick="replyComment(${c.id})">å›å¤</span>
          </div>
        </div>
      `).join('');
    }

    function likeComment(id) {
      const comment = comments.find(c => c.id === id);
      if (comment) {
        comment.likes++;
        renderComments();
      }
    }

    function replyComment(id) {
      const comment = comments.find(c => c.id === id);
      if (comment) {
        replyingTo = id;
        const input = document.getElementById('commentInput');
        input.placeholder = `å›å¤ ${comment.user}`;
        input.focus();
      }
    }

    function submitComment() {
      const input = document.getElementById('commentInput');
      if (input.value.trim()) {
        if (replyingTo) {
          // å›å¤è¯„è®º
          const comment = comments.find(c => c.id === replyingTo);
          comment.replies.push({
            id: Date.now(),
            user: 'æˆ‘',
            content: input.value,
            likes: 0
          });
          showToast('å›å¤æˆåŠŸ');
          replyingTo = null;
          input.placeholder = 'è¯´ç‚¹ä»€ä¹ˆ...';
        } else {
          // å‘è¡¨è¯„è®º
          comments.unshift({
            id: Date.now(),
            user: 'æˆ‘',
            content: input.value,
            likes: 0,
            replies: []
          });
        }
        input.value = '';
        renderComments();
      }
    }

    // åˆ†äº«åŠŸèƒ½
    function showShare() {
      document.getElementById('shareModal').style.display = 'flex';
    }

    function closeShare() {
      document.getElementById('shareModal').style.display = 'none';
    }

    function shareToWechat() {
      showToast('åˆ†äº«åˆ°å¾®ä¿¡åŠŸèƒ½ï¼ˆéœ€è¦å¾®ä¿¡SDKï¼‰');
      closeShare();
    }

    function shareToMoments() {
      showToast('åˆ†äº«åˆ°æœ‹å‹åœˆåŠŸèƒ½ï¼ˆéœ€è¦å¾®ä¿¡SDKï¼‰');
      closeShare();
    }

    function copyLink() {
      const link = window.location.href;
      navigator.clipboard.writeText(link).then(() => {
        showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        closeShare();
      }).catch(() => {
        showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        closeShare();
      });
    }

    initPage();
  </script>
</body>
</html>
